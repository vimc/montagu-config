# montagu-config
Config and scripts for deploying Montagu.

# Pre-deployment scripts
Diagnostic report config is committed to this repo, but if you need to change it, it can be re-generated by running `scripts/generate_real_diagnostic_reports_config.py`. 
This will generate a new yaml file "diagnostic-reports.yml" in the current working directory, which can then be copied into place in the relevant instance config directory.

# Deployment
To deploy UAT/Science/Production, first ensure `montagu-deploy` is installed:

    pip3 install --user montagu-deploy
    
Then start the required instance, e.g.:

    montagu start uat

See https://github.com/vimc/montagu-deploy for more details on the deploy tool.

# Post deployment
After deploying both Montagu AND OrderlyWeb, you may need to copy the data viz tools into place. This can be done
with `scripts/copy-vis-tool.sh`.

# Backup and restore
To run a backup or restore, ensure `privateer` is installed:

    pip3 install --user privateer

On production, to schedule backup of orderly (note on production, `montagu_orderly_volume` is the only target, as 
the db is backed up via barman):

    privateer schedule production --to=annex

On UAT or Science, to restore backups:

     privateer restore uat --from=annex

See https://github.com/reside-ic/privateer for more details on the backup tool.
